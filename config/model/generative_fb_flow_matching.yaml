# Facebook Flow Matching Model Configuration
# Uses Facebook's flow_matching library for both path and sampler
# Install: pip install flow-matching torchdyn

_target_: src.model.generative_module.GenerativeModule

# Neural network backbone
network:
  _target_: src.model.dit.dit.DiT
  img_size: ${image_size}
  patch: 4
  in_ch: 7      # 4 context (static,mov,tgt_obj,goal_region) + 2 coord_grid + 1 noisy_target (local mode)
  out_ch: 1     # target_goal
  dim: 256
  depth: 8
  heads: 8

# Facebook's flow matching path (Conditional OT)
path:
  _target_: src.model.paths.fb_flow_matching_path.FBFlowMatchingPath
  scheduler: condot
  sigma_min: 0.0

# Facebook's ODE sampler for inference
sampler:
  _target_: src.model.samplers.fb_ode_sampler.FBODESampler
  method: midpoint  # or 'dopri5' for adaptive
  atol: 1e-5
  rtol: 1e-5

# Optimizer
optimizer:
  _target_: torch.optim.AdamW
  _partial_: true
  lr: ${base_lr}
  weight_decay: 0.01

# Auxiliary loss weight (dice loss on reconstructed output)
aux_loss_weight: 0.005

# Channel configuration
# Global: 5 context (robot,goal,mov,stat,tgt_obj)
# Local: 4 context (static,movable,target_object,goal_region)
context_channels: 5
target_channels: 1

# Use local (object-centered) masks instead of global
use_local: ${use_local}  # inherited from top-level config
